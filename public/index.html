<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cong News</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            color: #0f172a;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
        }
        .card {
            background: #ffffff;
            border: 1px solid #f1f5f9;
            border-radius: 1rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .badge-live {
            background: #dbeafe;
            color: #1e40af;
        }
        .badge-scheduled {
            background: #d1fae5;
            color: #065f46;
        }
        .badge-daily {
            background: #fee2e2;
            color: #991b1b;
        }
        .price-card {
            position: relative;
            overflow: hidden;
        }
        .price-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            opacity: 0.05;
            border-radius: 50%;
            transform: translate(50%, -50%);
        }
        .news-item {
            display: block;
            text-decoration: none;
            color: inherit;
        }
        .news-item:hover .news-title {
            color: #3b82f6;
        }
        .news-summary {
            color: #64748b;
            font-size: 0.9375rem;
            line-height: 1.7;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        .prose {
            color: #374151;
            line-height: 1.6;
        }
        .prose h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #1e293b;
        }
        .prose h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }
        .prose h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: #1e293b;
        }
        .prose p {
            margin-bottom: 0.75rem;
        }
        .prose ul, .prose ol {
            margin-left: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .prose li {
            margin-bottom: 0.25rem;
        }
        .prose code {
            background-color: #f3f4f6;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-family: monospace;
        }
        .prose pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        .prose pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            font-size: 0.875rem;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f1f5f9;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .btn-primary:active {
            transform: translateY(0);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
            letter-spacing: -0.025em;
        }
        .price-large {
            font-size: 3.5rem;
            font-weight: 800;
            letter-spacing: -0.05em;
            line-height: 1;
        }
        .price-medium {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }
        @media (max-width: 768px) {
            .price-large {
                font-size: 2rem;
            }
            .price-medium {
                font-size: 1.5rem;
            }
            .section-title {
                font-size: 1.25rem;
            }
        }
        @media (max-width: 480px) {
            body {
                font-size: 0.875rem;
            }
            .price-large {
                font-size: 1.75rem;
            }
            .section-title {
                font-size: 1.125rem;
            }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }
        
        /* æç¤ºè¯å±•ç¤º */
        .prompt-display {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
            color: #475569;
            max-width: 800px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s ease;
        }
        .prompt-display:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
        
        /* æ–°é—»æ¿å— */
        .news-section {
            margin-bottom: 1.5rem;
        }
        .news-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .news-section-icon {
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.75rem;
        }
        
        /* é¢„æµ‹å›¾è¡¨ */
        .chart-container {
            position: relative;
            height: 350px !important;
            width: 100%;
            border-radius: 1rem;
            overflow: hidden;
            background: #ffffff;
            padding: 1rem;
            box-sizing: border-box;
        }
        #goldChart {
            width: 100% !important;
            height: 100% !important;
            min-height: 300px !important;
        }
        
        /* åˆ†ææ€»ç»“ */
        .analysis-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        .analysis-box-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl gradient-bg flex items-center justify-center shadow-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 tracking-tight">Cong News</h1>
                        <p class="text-xs text-gray-500" id="updateTime">æœ€åæ›´æ–°: --</p>
                    </div>
                </div>

                <!-- Prompts Display -->
                <div class="hidden md:flex items-center gap-2">
                    <div class="prompt-display" id="promptsDisplay">
                        ğŸ“ æœç´¢æç¤ºè¯ï¼šAIåº”ç”¨ | æœºå™¨äºº | é‡å­ç§‘æŠ€
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-3">
                    <button onclick="showPromptsModal()" class="text-sm text-gray-600 hover:text-gray-900 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6a2 2 0 002 2v6a2 2 0 002-2h-2a2 2 0 00-2-2v-6a2 2 0 002-2h6a2 2 0 002 2v6a2 2 0 002 2h-2a2 2 0 00-2-2v-6m-6 4h6a2 2 0 002 2v6a2 2 0 002-2h-2a2 2 0 00-2-2v-6"></path>
                        </svg>
                        æç¤ºè¯
                    </button>
                    <button onclick="updateData()" class="btn-primary" id="refreshBtn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357 2m15.357 2H15"></path>
                        </svg>
                        <span class="hidden sm:inline">åˆ·æ–°æ•°æ®</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Gold Price Section -->
        <section class="mb-12 fade-in">
            <div class="section-header">
                <h2 class="section-title">ä¼¦æ•¦é‡‘ä»·</h2>
                <span class="badge badge-live">ğŸ”´ å®æ—¶æ›´æ–°</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Price Card -->
                <div id="goldPriceContent" class="loading">
                    <div class="spinner"></div>
                </div>

                <!-- Chart Card -->
                <div class="card bg-white border border-gray-200 rounded-xl p-6">
                    <div class="section-header" style="margin-bottom: 1rem;">
                        <h3 class="section-title" style="font-size: 1.125rem;">æœªæ¥30åˆ†é’Ÿèµ°åŠ¿é¢„æµ‹</h3>
                        <span class="badge badge-scheduled">ğŸ“Š åŸºäºæ–°é—»åˆ†æ</span>
                    </div>
                    
                    <!-- Chart -->
                    <div class="chart-container">
                        <div id="goldChart"></div>
                    </div>
                </div>
            </div>

            <!-- Forecast Summary -->
            <div id="forecastSummarySection" class="mt-6 hidden">
                <div class="card bg-white border border-gray-200 rounded-xl p-6">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002 2v6a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2h2a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-900 mb-2">å¸‚åœºåˆ†ææ€»ç»“</h3>
                            <p id="forecastSummary" class="text-gray-600 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- News Sections -->
        <section class="fade-in stagger-1">
            <div class="section-header">
                <h2 class="section-title">çƒ­ç‚¹æ–°é—»</h2>
                <span class="badge badge-daily">ğŸ“° æ¯æ—¥æ›´æ–°</span>
            </div>

            <!-- AI Applications -->
            <div class="news-section">
                <div class="news-section-title">
                    <span class="news-section-icon bg-blue-100 text-blue-700">AI</span>
                    AI åº”ç”¨
                </div>
                <div class="card bg-white border border-gray-200 rounded-xl">
                    <div id="ai-news" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Robotics -->
            <div class="news-section">
                <div class="news-section-title">
                    <span class="news-section-icon bg-green-100 text-green-700">ğŸ¤–</span>
                    æœºå™¨äºº
                </div>
                <div class="card bg-white border border-gray-200 rounded-xl">
                    <div id="robotics-news" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Quantum Technology -->
            <div class="news-section">
                <div class="news-section-title">
                    <span class="news-section-icon bg-purple-100 text-purple-700">âš›ï¸</span>
                    é‡å­ç§‘æŠ€
                </div>
                <div class="card bg-white border border-gray-200 rounded-xl">
                    <div id="quantum-news" class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="mt-16 py-8 border-t border-gray-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-gray-500">æ•°æ®æ¥æºï¼šTavily Search API | æ›´æ–°é¢‘ç‡ï¼šæ¯ 2 å°æ—¶</p>
            <p class="text-sm text-gray-400 mt-2">Â© 2026 Cong News. All rights reserved.</p>
        </div>
    </footer>

    <!-- Prompts Modal -->
    <div id="promptsModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="sticky top-0 bg-white px-6 py-4 border-b border-gray-200 rounded-t-2xl flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-900">æ–°é—»æœç´¢æç¤ºè¯</h2>
                <button onclick="hidePromptsModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-6" id="promptsContent">
                <div class="text-center text-gray-500">
                    <div class="spinner mx-auto mb-4" style="width: 32px; height: 32px;"></div>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŠ è½½é‡‘ä»·æ•°æ®ï¼ˆä¼¦æ•¦é‡‘ä»·ï¼‰
        async function loadGoldPrice() {
            try {
                const response = await fetch('/api/london/latest');
                const data = await response.json();

                console.log('========== é‡‘ä»·æ•°æ® ==========');
                console.log('å®Œæ•´æ•°æ®:', data);
                console.log('forecastData å­˜åœ¨:', !!data.forecastData);
                console.log('forecastData ç±»å‹:', typeof data.forecastData);
                console.log('forecast_data å­˜åœ¨:', !!data.forecast_data);
                console.log('==============================');

                if (data && data.price_usd) {
                    const goldPriceContent = document.getElementById('goldPriceContent');
                    
                    // ä½¿ç”¨è“è‰²ä¸»é¢˜ï¼ˆä¼¦æ•¦é‡‘ä»·ï¼‰
                    goldPriceContent.innerHTML = `
                        <div class="price-card price-gold bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-300 rounded-xl p-6">
                            <div class="relative">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-blue-900 mb-2 tracking-wide">ä¼¦æ•¦é‡‘ä»·</p>
                                        <p class="price-large text-gray-900">$${data.price_usd.toLocaleString(undefined, {maximumFractionDigits: 2})}</p>
                                        <p class="text-sm text-blue-700 mt-1">ç¾å…ƒ/ç›å¸</p>
                                    </div>
                                    <div class="w-14 h-14 rounded-2xl bg-white/40 flex items-center justify-center flex-shrink-0 shadow-sm">
                                        <svg class="w-7 h-7 text-blue-700" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 0 10 10 10 10c0 4.42-2.72 8-6.48 8-6.48 8-2.72 8-6.48 8-10c0-4.42 2.72-8 6.48-8z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2 mt-3">
                                    <span class="bg-blue-100 text-blue-700 text-lg font-medium px-3 py-0.5 rounded">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2L2 12l10 10"></path>
                                        </svg>
                                    </span>
                                    <span class="text-lg font-semibold text-gray-900">ä¼¦æ•¦ç°è´§</span>
                                </div>
                            </div>
                        </div>
                    `;

                    // æ˜¾ç¤ºé¢„æµ‹å›¾è¡¨
                    if (data.forecastData && typeof data.forecastData === 'object') {
                        // forecastData å·²ç»æ˜¯å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨
                        console.log('é¢„æµ‹æ•°æ®ï¼ˆå¯¹è±¡ï¼‰:', data.forecastData);
                        renderChart(data.forecastData);
                    } else if (data.forecast_data) {
                        // forecast_data æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œéœ€è¦è§£æ
                        try {
                            const forecastData = JSON.parse(data.forecast_data);
                            console.log('é¢„æµ‹æ•°æ®ï¼ˆè§£æåï¼‰:', forecastData);
                            renderChart(forecastData);
                        } catch (e) {
                            console.error('è§£æé¢„æµ‹æ•°æ®å¤±è´¥:', e);
                            console.error('forecast_data å†…å®¹:', data.forecast_data);
                        }
                    } else {
                        console.warn('æ²¡æœ‰é¢„æµ‹æ•°æ®');
                    }

                    // æ˜¾ç¤ºé¢„æµ‹
                    if (data.forecast || data.forecast_data) {
                        const forecastSection = document.getElementById('forecastSummarySection');
                        const forecastSummary = document.getElementById('forecastSummary');
                        forecastSection.classList.remove('hidden');
                        forecastSummary.textContent = data.forecast || JSON.parse(data.forecast_data).summary;
                    }

                    // æ˜¾ç¤ºé¢„æµ‹
                    if (data.forecast) {
                        const forecastSection = document.getElementById('forecastSummarySection');
                        const forecastSummary = document.getElementById('forecastSummary');
                        forecastSection.classList.remove('hidden');
                        forecastSummary.textContent = data.forecast;
                    }

                    // æ›´æ–°æ—¶é—´
                    document.getElementById('updateTime').textContent = `æœ€åæ›´æ–°: ${data.date}`;
                }
            } catch (error) {
                console.error('åŠ è½½é‡‘ä»·å¤±è´¥:', error);
                document.getElementById('goldPriceContent').innerHTML = '<div class="p-6 text-center text-red-500">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        // æ¸²æŸ“é¢„æµ‹å›¾è¡¨
        function renderChart(data) {
            const chartDom = document.getElementById('goldChart');
            if (!chartDom) return;

            const chart = echarts.init(chartDom);
            
            const dates = data.data_points.map(point => point.time);
            const values = data.data_points.map(point => point.price);
            
            const option = {
                title: {
                    text: data.trend,
                    left: '3%',
                    textStyle: {
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#1e40af'
                    }
                },
                                tooltip: {
                    trigger: 'axis',
                    formatter: function (params) {
                        const point = params[0];
                        const dataIndex = point.dataIndex;
                        const time = dates[dataIndex];
                        const price = values[dataIndex];
                        return `<div style="font-weight: bold; margin-bottom: 5px;">${time}</div><div style="font-size: 18px; color: #3b82f6;">$${price}</div>`;
                    }
                },

                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: {
                        lineStyle: {
                            color: '#3b82f6'
                        }
                    },
                    axisLabel: {
                        color: '#64748b',
                        fontSize: 12
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'ä»·æ ¼',
                    axisLine: {
                        lineStyle: {
                            color: '#3b82f6'
                        }
                    },
                    axisLabel: {
                        color: '#64748b',
                        fontSize: 12,
                        formatter: '${value}'
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#e2e8f0',
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    name: 'é‡‘ä»·èµ°åŠ¿',
                    type: 'line',
                    data: values,
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 8,
                    itemStyle: {
                        color: '#3b82f6'
                    },
                    lineStyle: {
                        width: 3,
                        color: '#3b82f6'
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(59, 130, 246, 0.3)' },
                            { offset: 1, color: 'rgba(59, 130, 246, 0.05)' }
                        ])
                    },
                    markPoint: {
                        data: [
                            { coord: [dates[0], values[0]], value: 'ç°åœ¨' },
                            { coord: [dates[3], values[3]], value: '30åˆ†é’Ÿå' }
                        ],
                        symbol: 'circle',
                        symbolSize: 10,
                        itemStyle: {
                            color: '#ffffff',
                            borderColor: '#3b82f6',
                            borderWidth: 2
                        }
                    }
                }]
            };

            chart.setOption(option);
            
            window.addEventListener('resize', () => {
                chart.resize();
            });
        }

        // åŠ è½½ç‰¹å®šæ¿å—æ–°é—»
        async function loadNews(category, sectionId) {
            try {
                const response = await fetch(`/api/news/category/${category}`);
                const data = await response.json();

                const sectionContent = document.getElementById(sectionId);
                
                if (data && data.title) {
                    // è·å–å‘å¸ƒæ—¶é—´ï¼ˆä» URL ä¸­æå–æˆ–ä½¿ç”¨å½“å‰æ—¶é—´ï¼‰
                    const publishTime = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                    
                    // ç”Ÿæˆåˆ†ææ€»ç»“ï¼ˆåŸºäºæ–°é—»æ ‡é¢˜ï¼‰
                    const analysis = generateAnalysis(data.title, category);
                    
                    sectionContent.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <h3 class="news-title text-lg font-semibold text-gray-900 mb-2 line-clamp-2 hover:text-blue-600 transition-colors">${data.title}</h3>
                                    <div class="flex items-center gap-2 mb-3">
                                        <span class="bg-blue-100 text-blue-700 text-xs font-medium px-2 py-0.5 rounded">${category}</span>
                                        <span class="text-xs text-gray-400">${publishTime}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="analysis-box">
                                <div class="analysis-box-title">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0 9 9 0 00-18 0"></path>
                                    </svg>
                                    <span>AI åˆ†ææ€»ç»“</span>
                                </div>
                                <p class="text-gray-700 leading-relaxed text-sm">${analysis}</p>
                            </div>
                        </div>
                    `;
                } else {
                    sectionContent.innerHTML = `
                        <div class="p-6 text-center text-gray-500">
                            æš‚æ— è¯¥æ¿å—æ–°é—»
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`åŠ è½½${category}æ–°é—»å¤±è´¥:`, error);
                const sectionContent = document.getElementById(sectionId);
                if (sectionContent) {
                    sectionContent.innerHTML = `
                        <div class="p-6 text-center text-red-500">
                            åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•
                        </div>
                    `;
                }
            }
        }

        // ç”Ÿæˆåˆ†ææ€»ç»“
        function generateAnalysis(title, category) {
            const analysisPoints = [];
            
            // æ ¹æ®ç±»åˆ«æ·»åŠ åˆ†æç‚¹
            switch (category) {
                case 'AIåº”ç”¨':
                    analysisPoints.push('æ­¤ AI åº”ç”¨å±äºå½“å‰çƒ­é—¨çš„æŠ€æœ¯æ–¹å‘ï¼Œåæ˜ äº†äººå·¥æ™ºèƒ½åœ¨ç‰¹å®šé¢†åŸŸçš„å®é™…åº”ç”¨ã€‚');
                    analysisPoints.push('ä»æ–°é—»æ ‡é¢˜å¯ä»¥çœ‹å‡ºï¼Œè¯¥åº”ç”¨å¯èƒ½æ¶‰åŠæŠ€æœ¯åˆ›æ–°å’Œå•†ä¸šåŒ–è½åœ°çš„ç»“åˆã€‚');
                    analysisPoints.push('AI åº”ç”¨çš„å‘å±•è¶‹åŠ¿æ˜¾ç¤ºå‡ºå¸‚åœºéœ€æ±‚å’Œèµ„æœ¬å…³æ³¨åº¦ã€‚');
                    break;
                case 'æœºå™¨äºº':
                    analysisPoints.push('æ­¤æœºå™¨äººæ–°é—»æ¶‰åŠè‡ªåŠ¨åŒ–ã€æ™ºèƒ½æ§åˆ¶æˆ–äººæœºåä½œæŠ€æœ¯çš„å‘å±•ã€‚');
                    analysisPoints.push('åæ˜ äº†å·¥ä¸šã€æœåŠ¡æˆ–æ¶ˆè´¹çº§æœºå™¨äººæŠ€æœ¯çš„æœ€æ–°è¿›å±•ã€‚');
                    analysisPoints.push('æœºå™¨äººè¡Œä¸šæ­£æœç€æ›´æ™ºèƒ½ã€æ›´çµæ´»ã€æ›´å®‰å…¨çš„æ–¹å‘å‘å±•ã€‚');
                    break;
                case 'é‡å­ç§‘æŠ€':
                    analysisPoints.push('é‡å­ç§‘æŠ€æ–°é—»æ¶‰åŠé‡å­è®¡ç®—ã€é‡å­é€šä¿¡æˆ–é‡å­ææ–™çš„ç ”ç©¶çªç ´ã€‚');
                    analysisPoints.push('ä»£è¡¨äº†ä¸‹ä¸€ä»£ä¿¡æ¯æŠ€æœ¯çš„é‡å¤§é©æ–°ï¼Œå¯èƒ½æ”¹å˜ç°æœ‰çš„è®¡ç®—èŒƒå¼ã€‚');
                    analysisPoints.push('é‡å­ç§‘æŠ€çš„å‘å±•å¯¹å¯†ç å­¦ã€ä¼˜åŒ–ã€æ¨¡æ‹Ÿç­‰é¢†åŸŸäº§ç”Ÿæ·±è¿œå½±å“ã€‚');
                    break;
                default:
                    analysisPoints.push('è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æŠ€æœ¯æ–°é—»ï¼Œå¯èƒ½å¯¹ç›¸å…³è¡Œä¸šäº§ç”Ÿé‡è¦å½±å“ã€‚');
                    analysisPoints.push('å»ºè®®å…³æ³¨å…¶åç»­å‘å±•å’ŒæŠ€æœ¯åº”ç”¨ã€‚');
            }
            
            // æ ¹æ®æ ‡é¢˜å…³é”®è¯æ·»åŠ åˆ†æ
            if (title.includes('çªç ´') || title.includes('åˆ›æ–°')) {
                analysisPoints.push('è¯¥æ–°é—»æ¶‰åŠæŠ€æœ¯çªç ´å’Œåˆ›æ–°ï¼Œå¯èƒ½å¸¦æ¥è¡Œä¸šå˜é©ã€‚');
            }
            if (title.includes('å‘å¸ƒ') || title.includes('ä¸Šå¸‚')) {
                analysisPoints.push('äº§å“å‘å¸ƒæˆ–ä¸Šå¸‚æ ‡å¿—ç€æŠ€æœ¯å•†ä¸šåŒ–çš„å…³é”®é‡Œç¨‹ç¢‘ã€‚');
            }
            if (title.includes('åˆä½œ') || title.includes('æŠ•èµ„')) {
                analysisPoints.push('å•†ä¸šåˆä½œæˆ–æŠ•èµ„æ˜¾ç¤ºå‡ºå¸‚åœºä¿¡å¿ƒå’ŒæŠ€æœ¯ä»·å€¼çš„è®¤å¯ã€‚');
            }
            
            return analysisPoints.join(' ');
        }

        // åŠ è½½æ‰€æœ‰æ¿å—æ–°é—»
        async function loadAllNews() {
            await Promise.all([
                loadNews('AIåº”ç”¨', 'ai-news'),
                loadNews('æœºå™¨äºº', 'robotics-news'),
                loadNews('é‡å­ç§‘æŠ€', 'quantum-news')
            ]);
        }

        // æ›´æ–°æ•°æ®
        async function updateData() {
            const button = document.getElementById('refreshBtn');
            button.disabled = true;
            button.innerHTML = '<div class="spinner" style="width: 16px; height: 16px; border-width: 2px;"></div><span class="ml-2 text-sm">æ›´æ–°ä¸­...</span>';

            try {
                await fetch('/api/update', { method: 'POST' });
                await loadGoldPrice();
                await loadAllNews();
            } catch (error) {
                console.error('æ›´æ–°å¤±è´¥:', error);
            } finally {
                button.disabled = false;
                button.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357 2m15.357 2H15"></path></svg><span class="hidden sm:inline">åˆ·æ–°æ•°æ®</span>';
            }
        }

        // æ˜¾ç¤ºæç¤ºè¯
        async function showPromptsModal() {
            const modal = document.getElementById('promptsModal');
            const content = document.getElementById('promptsContent');

            modal.classList.remove('hidden');

            // åŠ è½½æç¤ºè¯
            try {
                const response = await fetch('/api/prompts');
                const data = await response.json();

                if (data && data.markdown) {
                    // ä½¿ç”¨ marked è§£æ Markdown
                    const htmlContent = marked.parse(data.markdown);

                    // æ·»åŠ è‡ªå®šä¹‰æ ·å¼
                    content.innerHTML = `
                        <div class="prose prose-sm max-w-none">
                            ${htmlContent}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½æç¤ºè¯å¤±è´¥:', error);
                content.innerHTML = '<div class="text-center text-red-500">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        // éšè—æç¤ºè¯
        function hidePromptsModal() {
            document.getElementById('promptsModal').classList.add('hidden');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('promptsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hidePromptsModal();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadGoldPrice();
            loadAllNews();
        });
    </script>
</body>
</html>
